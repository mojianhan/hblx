define(["jquery","./getData","weui"],function(t,e,a){"use strict";var h=n(t),v=n(e),_=n(a);function n(t){return t&&t.__esModule?t:{default:t}}!function(){var t=n("code"),o="",e=n("showTip"),l=n("state"),s="",d="",r="",u=0,a="";function n(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null}localStorage.setItem("CODE",t),localStorage.setItem("ACTIVE_NUMBER",l),p=t,h.default.ajax({url:"/tools/user/get-one.do",type:"GET",data:{code:p},success:function(t){200==t.status?(o=t.data.open_id,2==e&&(0,h.default)(".top-nav").click()):_.default.alert(t.data.errMsg)}}),m=l,h.default.ajax({url:"/tools/tools-crm/get-all.do",type:"GET",data:{activity_number:m},success:function(t){if(200==t.status){var e=t.data,a=0;1==e.setting_info.virtual_number_participants_status?(a=Number(e.participate_number||0)+Number(e.setting_info.virtual_number_participants||0),(0,h.default)(".participate-number").text(a)):(0,h.default)(".participate-number").text(e.participate_number||0),d=t.data.toolsSetting_info.start_time,r=t.data.toolsSetting_info.end_time,s=t.data.setting_info.distribution_type,u=e.total_margin}else _.default.alert(t.data.errMsg)},error:function(t){_.default.alert(t.data.errMsg)}}),(0,h.default)(".to-game").on("click",function(){(0,h.default)(".qr-code-container").addClass("hidden"),(0,h.default)(".share-container").addClass("hidden"),(0,h.default)(".error-alert-container").addClass("hidden");var t,e,a=(new Date).getTime(),n=new Date(d),i=new Date(r);return a<n?((0,h.default)(".error-alert-container").removeClass("hidden"),(0,h.default)('.error-status[data-status="1"]').removeClass("hidden"),void(0,h.default)(".start-time").text(d)):i<a?((0,h.default)(".error-alert-container").removeClass("hidden"),(0,h.default)('.error-status[data-status="2"]').removeClass("hidden"),void(0,h.default)(".end-time").text(r)):(2==s&&(location.href="/active/hblx/dist/game.html"),3==s&&(t=o,e=l,(0,v.default)({url:"/tools/tools-crm/get-selected.do",type:"GET",data:{open_id:t,activity_number:e}}).then(function(t){if(200==t.status){var e=t.data.player_info;if(Number(e.already_participate_number)>=Number(t.data.distribution_info.total_participate_times))return(0,h.default)(".error-alert-container").removeClass("hidden"),void(0,h.default)('.error-status[data-status="5"]').removeClass("hidden");if(0==e.use_participate_number&&0==e.use_share_number)return(0,h.default)(".error-alert-container").removeClass("hidden"),void(0,h.default)('.error-status[data-status="4"]').removeClass("hidden");if(0==e.use_participate_number&&0<Number(e.use_share_number))return(0,h.default)(".error-alert-container").removeClass("hidden"),(0,h.default)('.error-status[data-status="3"]').removeClass("hidden"),void(0,h.default)("#share-btn").removeClass("hidden");location.href="/active/hblx/dist/game.html"}25090==t.status&&(location.href="/active/hblx/dist/game.html")})),void(0==u&&((0,h.default)(".error-alert-container").removeClass("hidden"),(0,h.default)('.error-status[data-status="5"]').removeClass("hidden").text("奖项库存已被兑完，是否还要玩？"),(0,h.default)(".confim-msg").off().on("click",function(){location.href="/active/hblx/dist/game.html"}))))}),(0,h.default)(".ranking-list").on("click",function(){var t,e;(0,h.default)(".list-uls").text(""),t=o,e=l,(0,v.default)({url:"/tools/competition-set/get-all.do",type:"GET",data:{open_id:t,activity_number:e}}).then(function(t){if(200==t.status){var e=t.data.order_info;e.forEach(function(t,e){(0,h.default)(".list-uls").append('\n                    <li class="li-item">\n                        <p>No.'+(e+1)+'</p>\n                        <div class="img-mini">\n                            <img src="'+(t.headimgurl||"")+'" alt="">\n                        </div>\n                        <p>'+(t.nickname||"")+"</p>\n                        <p>"+(t.score||"")+"分</p>\n                    </li>\n                ")}),a=Object.keys(t.data.player_info),(0,h.default)(".level").text(0===a.length?"无":a[0])}})}),(0,h.default)(".my-prize").on("click",function(){var t,e;t=o,e=l,(0,v.default)({url:"/tools/competition-set/get-multi.do",type:"GET",data:{activity_number:e,open_id:t}}).then(function(t){if(200==t.status){var e=t.data.awards_info;if(0==e.length)return void(0,h.default)(".no-prize-container").removeClass("hidden");(0,h.default)(".prize-uls").removeClass("hidden"),(0,h.default)(".prize-level").text(e.level+":"),(0,h.default)(".prize-name").text(e.name),(0,h.default)(".prize-status").text(0==e.status?"未兑奖":"已兑奖"),(0,h.default)(".prize-deadline-detail").text(e.awards_end_time),(0,h.default)(".prize-lis").attr("data-id",e.prize_item_id)}25017==t.status&&(0,h.default)(".no-prize-container").removeClass("hidden")})}),(0,h.default)(".game-rule").on("click",function(){var t;(0,h.default)(".prize-list-detail").text(""),t=l,(0,v.default)({url:"/tools/tools-crm/get-all.do",type:"GET",data:{activity_number:t}}).then(function(t){if(200==t.status){var e=t.data;e.awards_info.forEach(function(t,e){(0,h.default)(".prize-list-detail").append("\n              <p key="+e+">\n                  <span>"+t.level+":</span>\n                  <span>"+t.prize_name+"</span>\n              </p>\n            ")}),(0,h.default)(".active-time-start").text(e.toolsSetting_info.start_time),(0,h.default)(".active-time-end").text(e.toolsSetting_info.end_time),(0,h.default)(".describe-detail").text(e.setting_info.comment),(0,h.default)(".redeem-address").text(e.awards_info[0].awards_address)}})}),(0,h.default)(".top-nav,.alert-close").on("click",function(){var t=(0,h.default)(this).attr("data-id");t&&((0,h.default)("."+t).hasClass("hidden")?(0,h.default)("."+t).removeClass("hidden"):(0,h.default)("."+t).addClass("hidden"))}),(0,h.default)(".follow").on("click",function(){var t=(0,h.default)(this).attr("data-id");(0,h.default)("."+t).addClass("hidden")}),(0,h.default)(".prize-lis").on("click",function(){(0,h.default)(this).attr("data-id")&&(location.href="./active/hblx/dist/prizeDetail.html?id="+(0,h.default)(this).attr("data-id"))}),(0,h.default)("#share-btn").on("click",function(){(0,h.default)(".share-container").removeClass("hidden")}),(0,h.default)(".share-container").on("click",function(){(0,h.default)(this).addClass("hidden")}),(0,h.default)('.follow[data-id="follow-us"]').on("click",function(){(0,h.default)(".qr-code-container").removeClass("hidden")}),(0,h.default)(".qr-code-container").on("click",function(){(0,h.default)(this).addClass("hidden")}),(0,h.default)(".qr-code-img").on("click",function(t){t.stopPropagation()}),i="红包来袭",c="玩游戏，赢大奖！",f=window.location.href,h.default.ajax({url:"/tools/sign-package/get-one.do",data:{url:f},success:function(t){wx.config({debug:!1,appId:t.data.appId,timestamp:t.data.timestamp,nonceStr:t.data.nonceStr,signature:t.data.signature,jsApiList:["checkJsApi","getLocation","chooseImage","uploadImage","onMenuShareWeibo","onMenuShareQZone","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:i,link:location.origin+"/active",imgUrl:"",success:function(){h.default.ajax({url:"/tools/competition-set/post-one.do",type:"POST",data:{activity_number:l,open_id:o,share_success:1},success:function(t){200==t.status&&_.default.confirm("分享成功！是否开始游戏？",{title:"分享成功",buttons:[{label:"取消",type:"default",onClick:function(){}},{label:"确定",type:"primary",onClick:function(){(0,h.default)(".to-game").click()}}]})}})},cancel:function(){}}),wx.onMenuShareAppMessage({title:i,desc:c,link:location.origin+"/active",imgUrl:"",type:"",dataUrl:"",success:function(){h.default.ajax({url:"/tools/competition-set/post-one.do",type:"POST",data:{activity_number:l,open_id:o,share_success:1},success:function(t){200==t.status&&_.default.confirm("分享成功！是否开始游戏？",{title:"分享成功",buttons:[{label:"取消",type:"default",onClick:function(){}},{label:"确定",type:"primary",onClick:function(){(0,h.default)(".to-game").click()}}]})}})},cancel:function(){}}),wx.onMenuShareQQ({title:i,desc:c,link:"http://dev.commodity.crm.9daye.com.cn/active",imgUrl:"",success:function(){h.default.ajax({url:"/tools/competition-set/post-one.do",type:"POST",data:{activity_number:l,open_id:o,share_success:1},success:function(t){200==t.status&&_.default.confirm("分享成功！是否开始游戏？",{title:"分享成功",buttons:[{label:"取消",type:"default",onClick:function(){}},{label:"确定",type:"primary",onClick:function(){(0,h.default)(".to-game").click()}}]})}})},cancel:function(){}}),wx.onMenuShareWeibo({title:i,desc:c,link:f,imgUrl:"",success:function(){h.default.ajax({url:"/tools/competition-set/post-one.do",type:"POST",data:{activity_number:l,open_id:o,share_success:1},success:function(t){200==t.status&&_.default.confirm("分享成功！是否开始游戏？",{title:"分享成功",buttons:[{label:"取消",type:"default",onClick:function(){}},{label:"确定",type:"primary",onClick:function(){(0,h.default)(".to-game").click()}}]})}})},cancel:function(){}}),wx.onMenuShareQZone({title:i,desc:c,link:f,imgUrl:"",success:function(){h.default.ajax({url:"/tools/competition-set/post-one.do",type:"POST",data:{activity_number:l,open_id:o,share_success:1},success:function(t){200==t.status&&_.default.confirm("分享成功！是否开始游戏？",{title:"分享成功",buttons:[{label:"取消",type:"default",onClick:function(){}},{label:"确定",type:"primary",onClick:function(){(0,h.default)(".to-game").click()}}]})}})},cancel:function(){}})})},error:function(t){_.default.alert(t.data.errMsg)}});var i,c,f;var m;var p}(),history.pushState(null,null,document.URL),window.addEventListener("popstate",function(){history.pushState(null,null,document.URL)})});